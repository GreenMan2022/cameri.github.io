<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Interra ‚Äî –û–Ω–ª–∞–π–Ω –∫–∞–º–µ—Ä—ã</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #000;
      color: white;
      height: 100vh;
      overflow: hidden;
    }

    #feed {
      height: 100vh;
      overflow-y: auto;
      scroll-snap-type: y mandatory;
    }

    .camera-item {
      height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 20px;
      scroll-snap-align: center;
    }

    .video-container {
      width: 100%;
      height: 70vh;
      background: #000;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      border-radius: 8px;
    }

    video {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
    }

    .play-overlay {
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0, 0, 0, 0.6);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      border-radius: 8px;
      z-index: 10;
      transition: opacity 0.3s ease;
    }

    .play-overlay.hidden {
      opacity: 0;
      pointer-events: none;
    }

    .play-btn {
      background: #3a86ff;
      color: white;
      border: none;
      padding: 12px 24px;
      font-size: 16px;
      border-radius: 8px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .status {
      font-size: 14px;
      color: #ccc;
      margin-top: 8px;
    }

    .info {
      text-align: center;
      width: 100%;
      margin-top: 15px;
    }

    .info h3 {
      margin: 0 0 5px 0;
      font-size: 18px;
    }

    .report-fab {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 60px;
      height: 60px;
      background: #3a86ff;
      color: white;
      border: none;
      border-radius: 50%;
      font-size: 24px;
      cursor: pointer;
      z-index: 100;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* === –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ "–°–æ–æ–±—â–∏—Ç—å" === */
    .modal-overlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.7);
      z-index: 1000;
      display: flex;
      align-items: flex-end;
    }

    .modal {
      width: 100%;
      background: white;
      border-radius: 16px 16px 0 0;
      padding: 20px;
      box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
      transform: translateY(100%);
      transition: transform 0.3s ease;
    }

    .modal.active {
      transform: translateY(0);
    }

    .form-group {
      margin-bottom: 15px;
    }

    label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
      color: #333;
    }

    select {
      width: 100%;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 16px;
      background: white;
    }

    .submit-btn {
      background: #3a86ff;
      color: white;
      border: none;
      padding: 14px;
      font-size: 16px;
      border-radius: 8px;
      width: 100%;
      margin-top: 10px;
    }

    /* === –û–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è === */
    .confirm-modal {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.2);
      z-index: 1002;
      text-align: center;
      width: 80%;
      max-width: 300px;
    }

    .confirm-buttons {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin-top: 15px;
    }

    .btn-yes, .btn-no {
      padding: 8px 16px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }

    .btn-yes {
      background: #3a86ff;
      color: white;
    }

    .btn-no {
      background: #ccc;
      color: #333;
    }

    /* –û–≤–µ—Ä–ª–µ–π –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ */
    .init-overlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.9);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      padding: 20px;
      text-align: center;
    }

    .init-btn {
      background: #3a86ff;
      color: white;
      border: none;
      padding: 15px 30px;
      font-size: 18px;
      border-radius: 8px;
      cursor: pointer;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <!-- –û–≤–µ—Ä–ª–µ–π –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ -->
  <div class="init-overlay" id="initOverlay">
    <h2>Interra ‚Äî –û–Ω–ª–∞–π–Ω –∫–∞–º–µ—Ä—ã</h2>
    <p>–ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –ø—Ä–æ—Å–º–æ—Ç—Ä</p>
    <button class="init-btn" id="startFirstBtn">‚ñ∂Ô∏è –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–µ—Ä–≤—É—é –∫–∞–º–µ—Ä—É</button>
  </div>

  <!-- –õ–µ–Ω—Ç–∞ -->
  <div id="feed"></div>

  <!-- –ö–Ω–æ–ø–∫–∞ "–°–æ–æ–±—â–∏—Ç—å" -->
  <button class="report-fab" id="reportBtn">üìù</button>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ -->
  <div class="modal-overlay" id="overlay">
    <div class="modal" id="reportModal">
      <h3>–°–æ–æ–±—â–∏—Ç—å –æ —Å–æ–±—ã—Ç–∏–∏</h3>
      <div class="form-group">
        <label for="eventType">–¢–∏–ø —Å–æ–±—ã—Ç–∏—è</label>
        <select id="eventType">
          <option value="dtp">–î–¢–ü</option>
          <option value="dps">–î–ü–°</option>
          <option value="proish">–ü—Ä–æ–∏—Å—à–µ—Å—Ç–≤–∏–µ</option>
          <option value="inter">–ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ–µ</option>
        </select>
      </div>
      <div class="form-group">
        <label>–ö–∞–º–µ—Ä–∞</label>
        <select id="cameraSelect" disabled>
          <option value="">–ó–∞–≥—Ä—É–∑–∫–∞...</option>
        </select>
      </div>
      <button class="submit-btn" id="submitBtn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    </div>
  </div>

  <!-- –û–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è -->
  <div class="confirm-modal" id="confirmModal" style="display: none;">
    <p>–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ?</p>
    <div class="confirm-buttons">
      <button class="btn-yes" id="confirmYes">–î–∞</button>
      <button class="btn-no" id="confirmNo">–ù–µ—Ç</button>
    </div>
  </div>

  <script>
    // === –í—Å–µ –∫–∞–º–µ—Ä—ã –ü–µ—Ä–≤–æ—É—Ä–∞–ª—å—Å–∫–∞ ===
    const CAMERAS = [
      { id: 1, name: "–ü–µ—Ä–µ–∫—Ä—ë—Å—Ç–æ–∫ –ï–º–ª–∏–Ω–∞-–õ–µ–Ω–∏–Ω–∞", url: "https://video.interra.ru/glaz.naroda.38-e60a533a34/tracks-v1/mono.m3u8?token=3.9CzUU5u-AAAAAAAAAEsAAAAAAAAAAHz8AV5bAgwb_bq4Q9BexUA3ze2E", street: "–ï–º–ª–∏–Ω–∞" },
      { id: 2, name: "–ü–µ—Ä–µ–∫—Ä—ë—Å—Ç–æ–∫ –õ–µ–Ω–∏–Ω–∞-–ö–æ—Å–º–æ–Ω–∞–≤—Ç–æ–≤", url: "https://video.interra.ru/glaz.naroda.69-88107b23ac/tracks-v1/mono.m3u8?token=3.9CzUU5u-AAAAAAAAAEsAAAAAAAAAABMSk4SEGVZtDQ81gwVqeUBRBIXE", street: "–õ–µ–Ω–∏–Ω–∞" },
      { id: 3, name: "–ü–µ—Ä–µ–∫—Ä—ë—Å—Ç–æ–∫ –õ–µ–Ω–∏–Ω–∞-–ö–æ—Å–º–æ–Ω–∞–≤—Ç–æ–≤", url: "https://video.interra.ru/glaz.naroda.7-719cef05e8/tracks-v1/mono.m3u8?token=3.9CzUU5u-AAAAAAAAAEsAAAAAAAAAAGSqutK7EdeiLrB7rOERcX3Wts-q", street: "–õ–µ–Ω–∏–Ω–∞" },
      { id: 4, name: "–ü—Ä–æ—Å–ø–µ–∫—Ç –ö–æ—Å–º–æ–Ω–∞–≤—Ç–æ–≤, –¥. 19", url: "https://video.interra.ru/glaz.naroda.27-f7e81f7bce/tracks-v1/mono.m3u8?token=3.9CzUU5u-AAAAAAAAAEsAAAAAAAAAAO8-2_rSX0V2qDVJqjDxFP68eVEC", street: "–ö–æ—Å–º–æ–Ω–∞–≤—Ç–æ–≤" },
      { id: 5, name: "–ü–µ—Ä–µ–∫—Ä—ë—Å—Ç–æ–∫ —É –¢–¶ –ú–ê–†–°", url: "https://video.interra.ru/glaz.naroda.9-ec155e8f81/tracks-v1/mono.m3u8?token=3.9CzUU5u-AAAAAAAAAEsAAAAAAAAAABayd-WjYHvATlrPCoSRCB9Qhp7t", street: "–õ–µ–Ω–∏–Ω–∞" },
      { id: 6, name: "–ü–µ—Ä–µ–∫—Ä—ë—Å—Ç–æ–∫ –ò–ª—å–∏—á–∞-–ö–æ—Å–º–æ–Ω–∞–≤—Ç–æ–≤", url: "https://video.interra.ru/glaz.naroda.14-e22ee71ce0/tracks-v1/mono.m3u8?token=3.9CzUU5u-AAAAAAAAAEsAAAAAAAAAAFIbXU9oIOtGLTqz6DiX5-QogJFE", street: "–ò–ª—å–∏—á–∞" },
      { id: 7, name: "–ù–∞–±–µ—Ä–µ–∂–Ω–∞—è –ø—Ä—É–¥–∞", url: "https://video.interra.ru/glaz.naroda.25-4cc98d0789/tracks-v1/mono.m3u8?token=3.9CzUU5u-AAAAAAAAAEsAAAAAAAAAAHRsHgp_0qihUk_HBzu17ck8D_Mh", street: "–ù–∞–±–µ—Ä–µ–∂–Ω–∞—è" },
      { id: 8, name: "–ü–µ—Ä–µ–∫—Ä—ë—Å—Ç–æ–∫ –í–∞—Ç—É—Ç–∏–Ω–∞-–°–æ–≤–µ—Ç—Å–∫–∞—è", url: "https://video.interra.ru/glaz.naroda.21-19bcd33f7f/tracks-v1/mono.m3u8?token=3.9CzUU5u-AAAAAAAAAEsAAAAAAAAAACI80V-ezRrkIeJGCOuiLqMO3L1t", street: "–í–∞—Ç—É—Ç–∏–Ω–∞" },
      { id: 9, name: "–ü–µ—Ä–µ–∫—Ä—ë—Å—Ç–æ–∫ –í–∞—Ç—É—Ç–∏–Ω–∞-–ú–∞–ª—ã—à–µ–≤–∞", url: "https://video.interra.ru/glaz.naroda.29-1c63155041/tracks-v1/mono.m3u8?token=3.9CzUU5u-AAAAAAAAAEsAAAAAAAAAAAA7leZJfczXfTUxqdcWm1UMTIYE", street: "–í–∞—Ç—É—Ç–∏–Ω–∞" },
      { id: 10, name: "–ü–ª–æ—â–∞–¥—å –ü–æ–±–µ–¥—ã", url: "https://video.interra.ru/glaz.naroda.8-c53ad07719/tracks-v1/mono.m3u8?token=3.9CzUU5u-AAAAAAAAAEsAAAAAAAAAAMLD72VML0zTKX93CIDenlWj9dKt", street: "–ü–ª–æ—â–∞–¥—å –ü–æ–±–µ–¥—ã" },
      { id: 11, name: "–ü–ª–æ—â–∞–¥—å –ü–æ–±–µ–¥—ã", url: "https://video.interra.ru/glaz.naroda.6-e95ca11965/tracks-v1/mono.m3u8?token=3.9CzUU5u-AAAAAAAAAEsAAAAAAAAAAERg-Eq8wmNvtnbw14DBkGUbvN4L", street: "–ü–ª–æ—â–∞–¥—å –ü–æ–±–µ–¥—ã" },
      { id: 12, name: "–í—Ö–æ–¥ –≤ –ø–∞—Ä–∫", url: "https://video.interra.ru/glaz.naroda.49-8793eb0dfd/tracks-v1/mono.m3u8?token=3.9CzUU5u-AAAAAAAAAEsAAAAAAAAAAGjW16v09aaEopwcTjZLvfXQJM6m", street: "–ü–∞—Ä–∫" },
      { id: 13, name: "–ü–µ—Ä–µ–∫—Ä—ë—Å—Ç–æ–∫ –í–∞—Ç—É—Ç–∏–Ω–∞-–ì–µ—Ä—Ü–µ–Ω–∞", url: "https://video.interra.ru/glaz.naroda.46-b14600392b/tracks-v1/mono.m3u8?token=3.9CzUU5u-AAAAAAAAAEsAAAAAAAAAAHpTPCtN6QpR7RIyY4vRpTA9_ny7", street: "–í–∞—Ç—É—Ç–∏–Ω–∞" },
      { id: 14, name: "–ü–µ—Ä–µ–∫—Ä—ë—Å—Ç–æ–∫ –í–∞—Ç—É—Ç–∏–Ω–∞-–ü–∞–ø–∞–Ω–∏–Ω—Ü–µ–≤", url: "https://video.interra.ru/glaz.naroda.47-f3ebf6b95c/tracks-v1/mono.m3u8?token=3.9CzUU5u-AAAAAAAAAEsAAAAAAAAAAJwfkzSpW2cCjiundMLGdO1LI5XW", street: "–í–∞—Ç—É—Ç–∏–Ω–∞" },
      { id: 15, name: "–ü–µ—Ä–µ–∫—Ä—ë—Å—Ç–æ–∫ –í–∞—Ç—É—Ç–∏–Ω–∞-–í–æ–ª–æ–¥–∞—Ä—Å–∫–æ–≥–æ", url: "https://video.interra.ru/glaz.naroda.48-96160aaa09/tracks-v1/mono.m3u8?token=3.9CzUU5u-AAAAAAAAAEsAAAAAAAAAAJJQBHdEhiU9vJNpfTYkNKLzmstk", street: "–í–∞—Ç—É—Ç–∏–Ω–∞" },
      { id: 16, name: "–ü–µ—Ä–µ–∫—Ä—ë—Å—Ç–æ–∫ –í–∞—Ç—É—Ç–∏–Ω–∞-–ì–∞–≥–∞—Ä–∏–Ω–∞", url: "https://video.interra.ru/glaz.naroda.33-fad92591aa/tracks-v1/mono.m3u8?token=3.9CzUU5u-AAAAAAAAAEsAAAAAAAAAAIa8SSqK1QMAsi8pjhoKshKM6xE8", street: "–í–∞—Ç—É—Ç–∏–Ω–∞" },
      { id: 17, name: "–ü–µ—Ä–µ–∫—Ä—ë—Å—Ç–æ–∫ –ß–∫–∞–ª–æ–≤–∞-–ò–ª—å–∏—á–∞", url: "https://video.interra.ru/glaz.naroda.3-50c57ffd3e/tracks-v1/mono.m3u8?token=3.9CzUU5u-AAAAAAAAAEsAAAAAAAAAAEzXxV8plI46SBNwkpSd2yhh2ukr", street: "–ß–∫–∞–ª–æ–≤–∞" },
      { id: 18, name: "–ü–µ—Ä–µ–∫—Ä—ë—Å—Ç–æ–∫ –ß–∫–∞–ª–æ–≤–∞-–ì–µ—Ä—Ü–µ–Ω–∞", url: "https://video.interra.ru/glaz.naroda.45-b9b0186773/tracks-v1/mono.m3u8?token=3.9CzUU5u-AAAAAAAAAEsAAAAAAAAAAKOgh_KQet820Aojm4hVAre5zr_Y", street: "–ß–∫–∞–ª–æ–≤–∞" },
      { id: 19, name: "–ü–µ—Ä–µ–∫—Ä—ë—Å—Ç–æ–∫ –ß–∫–∞–ª–æ–≤–∞-–ü–∞–ø–∞–Ω–∏–Ω—Ü–µ–≤", url: "https://video.interra.ru/glaz.naroda.61-93ff24e89c/tracks-v1/mono.m3u8?token=3.9CzUU5u-AAAAAAAAAEsAAAAAAAAAAOIKxHk6pLXSg7uzNTYQiziq1vv0", street: "–ß–∫–∞–ª–æ–≤–∞" },
      { id: 20, name: "–ü–µ—Ä–µ–∫—Ä—ë—Å—Ç–æ–∫ –õ–µ–Ω–∏–Ω–∞-–ë–µ—Ä–µ–≥–æ–≤–∞—è", url: "https://video.interra.ru/glaz.naroda.45-b9b0186773/tracks-v1/mono.m3u8?token=3.9CzUU5u-AAAAAAAAAEsAAAAAAAAAAKOgh_KQet820Aojm4hVAre5zr_Y", street: "–õ–µ–Ω–∏–Ω–∞" },
      { id: 21, name: "–ü–µ—Ä–µ–∫—Ä—ë—Å—Ç–æ–∫ –õ–µ–Ω–∏–Ω–∞-–ß–µ–∫–∏—Å—Ç–æ–≤", url: "https://video.interra.ru/glaz.naroda.4-f9c1801660/tracks-v1/mono.m3u8?token=3.9CzUU5u-AAAAAAAAAEsAAAAAAAAAAC6_-QWK7Oa_TX1NSSJE_HeyndsS", street: "–õ–µ–Ω–∏–Ω–∞" },
      { id: 22, name: "–ü–µ—Ä–µ–∫—Ä—ë—Å—Ç–æ–∫ –õ–µ–Ω–∏–Ω–∞-–ò–ª—å–∏—á–∞", url: "https://video.interra.ru/glaz.naroda.65-9259fce158/tracks-v1/mono.m3u8?token=3.9CzUU5u-AAAAAAAAAEsAAAAAAAAAAD4jfac0sy8Ay91TN-JfzCG_2kIT", street: "–õ–µ–Ω–∏–Ω–∞" },
      { id: 23, name: "–ü–µ—Ä–µ–∫—Ä—ë—Å—Ç–æ–∫ –õ–µ–Ω–∏–Ω–∞-–ò–ª—å–∏—á–∞-–¢—Ä—É–±–Ω–∏–∫–æ–≤", url: "https://video.interra.ru/glaz.naroda.37-7fdf4aae90/tracks-v1/mono.m3u8?token=3.9CzUU5u-AAAAAAAAAEsAAAAAAAAAAMtG4TISG-aM51pFWZXAzETyJjBk", street: "–õ–µ–Ω–∏–Ω–∞" },
      { id: 24, name: "–ü–µ—Ä–µ–∫—Ä—ë—Å—Ç–æ–∫ –¢—Ä—É–±–Ω–∏–∫–æ–≤-–ì–µ—Ä—Ü–µ–Ω–∞", url: "https://video.interra.ru/glaz.naroda.28-375f2cc29e/tracks-v1/mono.m3u8?token=3.9CzUU5u-AAAAAAAAAEsAAAAAAAAAAIoZ6VpaxgZ4XY5ziRR2M3WlfZ8G", street: "–¢—Ä—É–±–Ω–∏–∫–æ–≤" },
      { id: 25, name: "–ü–µ—Ä–µ–∫—Ä—ë—Å—Ç–æ–∫ –¢—Ä—É–±–Ω–∏–∫–æ–≤-–ü–∞–ø–∞–Ω–∏–Ω—Ü–µ–≤", url: "https://video.interra.ru/glaz.naroda.30-9c8902aa36/tracks-v1/mono.m3u8?token=3.9CzUU5u-AAAAAAAAAEsAAAAAAAAAAJBCgbnYpxS3mek33e5gRgkpUovi", street: "–¢—Ä—É–±–Ω–∏–∫–æ–≤" },
      { id: 26, name: "–ü–µ—Ä–µ–∫—Ä—ë—Å—Ç–æ–∫ –¢—Ä—É–±–Ω–∏–∫–æ–≤-–®–∫–æ–ª—å–Ω–∞—è", url: "https://video.interra.ru/glaz.naroda.30-9c8902aa36/tracks-v1/mono.m3u8?token=3.9CzUU5u-AAAAAAAAAEsAAAAAAAAAAJBCgbnYpxS3mek33e5gRgkpUovi", street: "–¢—Ä—É–±–Ω–∏–∫–æ–≤" },
      { id: 27, name: "–ü–µ—Ä–µ–∫—Ä—ë—Å—Ç–æ–∫ –¢—Ä—É–±–Ω–∏–∫–æ–≤-–ì–∞–≥–∞—Ä–∏–Ω–∞", url: "https://video.interra.ru/glaz.naroda.30-9c8902aa36/tracks-v1/mono.m3u8?token=3.9CzUU5u-AAAAAAAAAEsAAAAAAAAAAJBCgbnYpxS3mek33e5gRgkpUovi", street: "–¢—Ä—É–±–Ω–∏–∫–æ–≤" },
      { id: 28, name: "–ü. –•—Ä–æ–º–ø–∏–∫, –∫—Ä—É–≥–æ–≤–æ–π –ø–µ—Ä–µ–∫—Ä—ë—Å—Ç–æ–∫", url: "https://video.interra.ru/glaz.naroda.30-9c8902aa36/tracks-v1/mono.m3u8?token=3.9CzUU5u-AAAAAAAAAEsAAAAAAAAAAJBCgbnYpxS3mek33e5gRgkpUovi", street: "–•—Ä–æ–º–ø–∏–∫" },
      { id: 29, name: "–ì–æ—Ä–æ–¥–æ–∫ –Ω–∞ –ë–µ—Ä–µ–≥–æ–≤–æ–π 20", url: "https://video.interra.ru/glaz.naroda.30-9c8902aa36/tracks-v1/mono.m3u8?token=3.9CzUU5u-AAAAAAAAAEsAAAAAAAAAAJBCgbnYpxS3mek33e5gRgkpUovi", street: "–ë–µ—Ä–µ–≥–æ–≤–∞—è" },
      { id: 30, name: "–ü–µ—Ä–µ–∫—Ä—ë—Å—Ç–æ–∫ –î–∞–Ω–∏–ª–æ–≤–∞-–ß–µ–∫–∏—Å—Ç–æ–≤", url: "https://video.interra.ru/glaz.naroda.41-689af1f0f5/tracks-v1/mono.m3u8?token=3.9CzUU5u-AAAAAAAAAEsAAAAAAAAAAIk2Oi2v6utpI-VnnCkOoTecKOBo", street: "–î–∞–Ω–∏–ª–æ–≤–∞" },
      { id: 31, name: "–ü–µ—Ä–µ–∫—Ä—ë—Å—Ç–æ–∫ –î–∞–Ω–∏–ª–æ–≤–∞-–ö—Ä–∞—Å–Ω–æ–¥–æ–Ω—Ü–µ–≤", url: "https://video.interra.ru/glaz.naroda.40-70e440be67/tracks-v1/mono.m3u8?token=3.9CzUU5u-AAAAAAAAAEsAAAAAAAAAAHiw7qBs2t__8Eh8QuInL9_7TbC9", street: "–î–∞–Ω–∏–ª–æ–≤–∞" },
      { id: 32, name: "–ü–µ—Ä–µ–∫—Ä—ë—Å—Ç–æ–∫ –°—Ç—Ä–æ–∏—Ç–µ–ª–µ–π-–ì—Ä–æ–º–æ–≤–æ–π", url: "https://video.interra.ru/glaz.naroda.18-5d5aa2fe13/tracks-v1/mono.m3u8?token=3.9CzUU5u-AAAAAAAAAEsAAAAAAAAAAO_LrHz5W9KkkYQHjF2usKCNFkq2", street: "–°—Ç—Ä–æ–∏—Ç–µ–ª–µ–π" },
      { id: 33, name: "–ü–µ—Ä–µ–∫—Ä—ë—Å—Ç–æ–∫ –°—Ç—Ä–æ–∏—Ç–µ–ª–µ–π-–ö—Ä–∞—Å–Ω–æ–¥–æ–Ω—Ü–µ–≤", url: "https://video.interra.ru/glaz.naroda.39-1360aa09c3/tracks-v1/mono.m3u8?token=3.9CzUU5u-AAAAAAAAAEsAAAAAAAAAALTmT7aXbt8EQvVoTSh6S6o0Yq3h", street: "–°—Ç—Ä–æ–∏—Ç–µ–ª–µ–π" },
      { id: 34, name: "–ü–µ—Ä–µ–∫—Ä—ë—Å—Ç–æ–∫ –í–∞–π–Ω–µ—Ä–∞-–ë–µ—Ä–µ–≥–æ–≤–∞—è", url: "https://video.interra.ru/glaz.naroda.35-34558b3c59/tracks-v1/mono.m3u8?token=3.9CzUU5u-AAAAAAAAAEsAAAAAAAAAAITInK__BfhI-SNrKd4BoSBIdiy6", street: "–í–∞–π–Ω–µ—Ä–∞" },
      { id: 35, name: "–ü–µ—Ä–µ–∫—Ä—ë—Å—Ç–æ–∫ –í–∞–π–Ω–µ—Ä–∞-–ö–æ–ª—å—Ü–µ–≤–∞—è", url: "https://video.interra.ru/glaz.naroda.13-8ca559e5bd/tracks-v1/mono.m3u8?token=3.9CzUU5u-AAAAAAAAAEsAAAAAAAAAAHnTWKNTMOM5rCvtiNGNm0myL4_i", street: "–í–∞–π–Ω–µ—Ä–∞" },
      { id: 36, name: "–ü–µ—Ä–µ–∫—Ä—ë—Å—Ç–æ–∫ –í–∞–π–Ω–µ—Ä–∞-–ì—Ä–æ–º–æ–≤–æ–π", url: "https://video.interra.ru/glaz.naroda.31-eea5bf8987/tracks-v1/mono.m3u8?token=3.9CzUU5u-AAAAAAAAAEsAAAAAAAAAAHOknDMgtjdyik3MonZ0V0XHxttc", street: "–í–∞–π–Ω–µ—Ä–∞" },
      { id: 37, name: "–ü–µ—Ä–µ–∫—Ä—ë—Å—Ç–æ–∫ –í–∞–π–Ω–µ—Ä–∞-–ö—Ä–∞—Å–Ω–æ–¥–æ–Ω—Ü–µ–≤", url: "https://video.interra.ru/glaz.naroda.34-2e2f52f277/tracks-v1/mono.m3u8?token=3.9CzUU5u-AAAAAAAAAEsAAAAAAAAAAKoTLdlQ49cUdhpTIjMbEaD81ObK", street: "–í–∞–π–Ω–µ—Ä–∞" },
      { id: 38, name: "–£–ª. –í–∞–π–Ω–µ—Ä–∞, –≤—ã–µ–∑–¥ –æ—Ç –º–∞–≥–∞–∑–∏–Ω–∞ –°–û–ú", url: "https://video.interra.ru/glaz.naroda.32-22975f2b2d/tracks-v1/mono.m3u8?token=3.9CzUU5u-AAAAAAAAAEsAAAAAAAAAAK1URRjrl3ZVkEB2-TSQx9RWcfJ4", street: "–í–∞–π–Ω–µ—Ä–∞" },
      { id: 39, name: "–†—ã–Ω–æ–∫", url: "https://video.interra.ru/glaz.naroda.15-f1aebe0b86/tracks-v1/mono.m3u8?token=3.9CzUU5u-AAAAAAAAAEsAAAAAAAAAAE6FGwzY-dN05B6KQEcPQwJRO-If", street: "–†—ã–Ω–æ–∫" },
      { id: 40, name: "–ü–µ—Ä–µ–∫—Ä—ë—Å—Ç–æ–∫ –í–∞–π–Ω–µ—Ä–∞-–ò–ª—å–∏—á–∞", url: "https://video.interra.ru/glaz.naroda.36-f4d80dd3cf/tracks-v1/mono.m3u8?token=3.9CzUU5u-AAAAAAAAAEsAAAAAAAAAADTcF098EjzS7rQiDF-YOCAglQAS", street: "–í–∞–π–Ω–µ—Ä–∞" },
      { id: 41, name: "–ü–µ—Ä–µ–∫—Ä—ë—Å—Ç–æ–∫ –Ω–∞ —É–ª–∏—Ü–µ –°–∞–Ω—Ç–µ—Ö–∏–∑–¥–µ–ª–∏–π –≤–±–ª–∏–∑–∏ –¥–æ–º–∞ ‚Ññ28", url: "https://video.interra.ru/glaz.naroda.68-470580056f/tracks-v1/mono.m3u8?token=3.9CzUU5u-AAAAAAAAAEsAAAAAAAAAAAIZMKpITECzm_bsql7jK8SaZjKw", street: "–°–∞–Ω—Ç–µ—Ö–∏–∑–¥–µ–ª–∏–π" },
      { id: 42, name: "–ü. –î–∏–Ω–∞—Å, –∫—Ä—É–≥–æ–≤–æ–π –ø–µ—Ä–µ–∫—Ä—ë—Å—Ç–æ–∫", url: "https://video.interra.ru/glaz.naroda.11-067f37bc81/tracks-v1/mono.m3u8?token=3.9CzUU5u-AAAAAAAAAEsAAAAAAAAAAPHda2mNPXsjZy7VEGak5e4sOBnT", street: "–î–∏–Ω–∞—Å" },
      { id: 43, name: "–ü–µ—Ä–µ–∫—Ä—ë—Å—Ç–æ–∫ –ò–ª—å–∏—á–∞ - 50 –ª–µ—Ç –°–°–°–†", url: "https://video.interra.ru/glaz.naroda.62-60daf9cda0/tracks-v1/mono.m3u8?token=3.9CzUU5u-AAAAAAAAAEsAAAAAAAAAACVZ-BLGA3sQS9m7AZXB5Nqz6BUm", street: "–ò–ª—å–∏—á–∞" },
      { id: 44, name: "–ü. –î–∏–Ω–∞—Å, –ø–ª–æ—â–∞–¥—å", url: "https://video.interra.ru/glaz.naroda.62-60daf9cda0/tracks-v1/mono.m3u8?token=3.9CzUU5u-AAAAAAAAAEsAAAAAAAAAACVZ-BLGA3sQS9m7AZXB5Nqz6BUm", street: "–î–∏–Ω–∞—Å" },
      { id: 45, name: "–ü–µ—Ä–µ–∫—Ä—ë—Å—Ç–æ–∫ –¢–∞–ª–∏—Ü–∞ - –°–∞–∫–∫–æ –∏ –í–∞–Ω—Ü–µ—Ç—Ç–∏", url: "https://video.interra.ru/glaz.naroda.17-49dca37237/tracks-v1/mono.m3u8?token=3.9CzUU5u-AAAAAAAAAEsAAAAAAAAAAH29iQD9IXRCc-cgdRIXudyocrpu", street: "–¢–∞–ª–∏—Ü–∞" },
      { id: 46, name: "–ü–µ—Ä–µ–∫—Ä—ë—Å—Ç–æ–∫ –≠–Ω–≥–µ–ª—å—Å–∞-–§—É—Ä–º–∞–Ω–æ–≤–∞-–ë—É—Ä–∏–ª—å—â–∏–∫–æ–≤", url: "https://video.interra.ru/glaz.naroda.42-097dc52569/tracks-v1/mono.m3u8?token=3.9CzUU5u-AAAAAAAAAEsAAAAAAAAAAA_mpHJ8uHP2H9Q1Zbhd5732id8N", street: "–≠–Ω–≥–µ–ª—å—Å–∞" },
      { id: 47, name: "–ü–µ—Ä–µ–∫—Ä—ë—Å—Ç–æ–∫ –ö–æ–º–º—É–Ω–∏—Å—Ç–∏—á–µ—Å–∫–∞—è-–õ–µ–Ω–∏–Ω–∞", url: "https://video2.interra.ru/glaz.naroda.504-d8b2dcde14/tracks-v1/mono.m3u8?token=3.9CzUU5u-AAAAAAAAAEsAAAAAAAAAAOnSd-VAJBBftYpJxGc2KU8-Mcx2", street: "–õ–µ–Ω–∏–Ω–∞" }
    ];

    // === –≠–ª–µ–º–µ–Ω—Ç—ã ===
    const feed = document.getElementById('feed');
    const initOverlay = document.getElementById('initOverlay');
    const startFirstBtn = document.getElementById('startFirstBtn');
    const reportBtn = document.getElementById('reportBtn');
    const overlay = document.getElementById('overlay');
    const reportModal = document.getElementById('reportModal');
    const cameraSelect = document.getElementById('cameraSelect');
    const eventType = document.getElementById('eventType');
    const submitBtn = document.getElementById('submitBtn');
    const confirmModal = document.getElementById('confirmModal');
    const confirmYes = document.getElementById('confirmYes');
    const confirmNo = document.getElementById('confirmNo');
    const tg = Telegram.WebApp;
    tg.expand();

    const HLS_INSTANCES = {};
    let ACTIVE_INDEX = null;

    let lastScrollTop = 0;
    let scrollDiff = 0;
    const SCROLL_TOLERANCE = 50;

    // === –°–æ–∑–¥–∞—ë–º –ª–µ–Ω—Ç—É ===
    CAMERAS.forEach((cam, index) => {
      const item = document.createElement('div');
      item.className = 'camera-item';
      item.dataset.index = index;

      const container = document.createElement('div');
      container.className = 'video-container';
      container.dataset.index = index;

      const video = document.createElement('video');
      video.id = `camera-${index}`;
      video.setAttribute('playsinline', '');
      video.muted = true;

      const overlayEl = document.createElement('div');
      overlayEl.className = 'play-overlay';
      overlayEl.id = `overlay-${index}`;
      overlayEl.innerHTML = `
        <button class="play-btn" data-index="${index}">
          <span class="icon">‚ñ∂Ô∏è</span>
          <span class="text">–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏</span>
        </button>
        <div class="status">–û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ</div>
      `;

      container.appendChild(video);
      container.appendChild(overlayEl);
      item.appendChild(container);

      const info = document.createElement('div');
      info.className = 'info';
      info.innerHTML = `<h3>${cam.name}</h3>`;
      item.appendChild(info);

      feed.appendChild(item);
    });

    // === –ö–Ω–æ–ø–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ ===
    startFirstBtn.addEventListener('click', () => {
      initOverlay.remove();
    });

    // === –ö–Ω–æ–ø–∫–∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è ===
    document.querySelectorAll('.play-btn').forEach(btn => {
      btn.addEventListener('click', function (e) {
        e.stopPropagation();
        const index = parseInt(this.dataset.index);
        const video = document.getElementById(`camera-${index}`);
        const overlayEl = document.getElementById(`overlay-${index}`);
        const statusEl = overlayEl.querySelector('.status');

        if (ACTIVE_INDEX === index) {
          stopCamera(index);
          ACTIVE_INDEX = null;
          this.innerHTML = '<span class="icon">‚ñ∂Ô∏è</span><span class="text">–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏</span>';
          statusEl.textContent = '–û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ';
          overlayEl.classList.remove('hidden');
        } else {
          if (ACTIVE_INDEX !== null) {
            stopCamera(ACTIVE_INDEX);
            const prevOverlay = document.getElementById(`overlay-${ACTIVE_INDEX}`);
            prevOverlay.querySelector('.play-btn').innerHTML = '<span class="icon">‚ñ∂Ô∏è</span><span class="text">–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏</span>';
            prevOverlay.querySelector('.status').textContent = '–û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ';
            prevOverlay.classList.remove('hidden');
          }

          statusEl.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞...';
          startCamera(index, video, overlayEl);
          ACTIVE_INDEX = index;
          this.innerHTML = '<span class="icon">‚è∏Ô∏è</span><span class="text">–ü–∞—É–∑–∞</span>';
          statusEl.textContent = '–¢—Ä–∞–Ω—Å–ª—è—Ü–∏—è';
          overlayEl.classList.add('hidden');
        }
      });
    });

    // === –ó–∞–ø—É—Å–∫ –∫–∞–º–µ—Ä—ã ===
    function startCamera(index, video, overlayEl) {
      if (HLS_INSTANCES[index]) {
        HLS_INSTANCES[index].destroy();
      }

      video.pause();
      video.src = '';
      video.removeAttribute('src');
      video.load();

      if (Hls.isSupported()) {
        const hls = new Hls({
          enableWorker: true,
          lowLatencyMode: true,
          backBufferLength: 30
        });

        hls.on(Hls.Events.ERROR, (e, data) => {
          const statusEl = overlayEl.querySelector('.status');
          statusEl.textContent = `–û—à–∏–±–∫–∞: ${data.type}`;
          if (data.fatal) {
            if (data.type === 'networkError') hls.startLoad();
            if (data.type === 'mediaError') hls.recoverMediaError();
          }
        });

        hls.on(Hls.Events.MANIFEST_PARSED, () => {
          video.play().catch(e => console.warn('Play failed:', e));
        });

        hls.loadSource(CAMERAS[index].url);
        hls.attachMedia(video);
        HLS_INSTANCES[index] = hls;
      } else {
        video.src = CAMERAS[index].url;
        video.addEventListener('loadedmetadata', () => {
          video.play();
        });
      }
    }

    // === –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–∞–º–µ—Ä—ã ===
    function stopCamera(index) {
      if (HLS_INSTANCES[index]) {
        HLS_INSTANCES[index].destroy();
        delete HLS_INSTANCES[index];
      }

      const video = document.getElementById(`camera-${index}`);
      if (video) {
        video.pause();
        video.src = '';
        video.removeAttribute('src');
        video.load();
      }
    }

    // === –£–º–Ω—ã–π —Å–∫—Ä–æ–ª–ª ===
    feed.addEventListener('scroll', () => {
      const scrollTop = feed.scrollTop;

      if (ACTIVE_INDEX !== null) {
        const diff = Math.abs(scrollTop - lastScrollTop);
        scrollDiff += diff;

        if (scrollDiff > SCROLL_TOLERANCE) {
          const overlayEl = document.getElementById(`overlay-${ACTIVE_INDEX}`);
          const btn = overlayEl.querySelector('.play-btn');
          const statusEl = overlayEl.querySelector('.status');

          stopCamera(ACTIVE_INDEX);
          ACTIVE_INDEX = null;

          btn.innerHTML = '<span class="icon">‚ñ∂Ô∏è</span><span class="text">–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏</span>';
          statusEl.textContent = '–û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ';
          overlayEl.classList.remove('hidden');

          scrollDiff = 0;
        }
      }

      lastScrollTop = scrollTop;
    });

    // === –î–µ–ª–∞–µ—Ç —Å–∫—Ä–∏–Ω—à–æ—Ç —Å –≤–∏–¥–µ–æ ===
    function captureVideoFrame(video) {
      if (!video || video.videoWidth === 0 || video.videoHeight === 0) return null;

      const canvas = document.createElement('canvas');
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      const ctx = canvas.getContext('2d');
      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
      return canvas.toDataURL('image/jpeg', 0.7); // base64, 70% –∫–∞—á–µ—Å—Ç–≤–∞
    }

    // === –ó–∞–≥—Ä—É–∂–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞ ImgBB ===
    async function uploadToImgBB(base64Image) {
      const formData = new FormData();
      formData.append('key', '822095b4ccdede627fd907bf3ff13276'); // –¢–≤–æ–π API-–∫–ª—é—á
      formData.append('image', base64Image.split(',')[1]); // —É–±–∏—Ä–∞–µ–º –ø—Ä–µ—Ñ–∏–∫—Å

      try {
        const response = await fetch('https://api.imgbb.com/1/upload', {
          method: 'POST',
          body: formData
        });

        const result = await response.json();
        if (result.success) {
          return result.data.url; // –ø—Ä—è–º–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
        } else {
          console.error("–û—à–∏–±–∫–∞ ImgBB:", result);
          return null;
        }
      } catch (e) {
        console.error("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –Ω–∞ ImgBB:", e);
        return null;
      }
    }

    // === –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ "–°–æ–æ–±—â–∏—Ç—å" ===
    reportBtn.addEventListener('click', () => {
      cameraSelect.innerHTML = '';

      if (ACTIVE_INDEX !== null) {
        const cam = CAMERAS[ACTIVE_INDEX];
        const opt = document.createElement('option');
        opt.value = cam.id;
        opt.textContent = cam.name;
        cameraSelect.appendChild(opt);
      } else {
        const opt = document.createElement('option');
        opt.value = '';
        opt.textContent = '–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–π –∫–∞–º–µ—Ä—ã';
        cameraSelect.appendChild(opt);
      }

      overlay.style.display = 'flex';
      setTimeout(() => {
        reportModal.classList.add('active');
      }, 10);
    });

    overlay.addEventListener('click', (e) => {
      if (e.target === overlay) {
        reportModal.classList.remove('active');
        setTimeout(() => {
          overlay.style.display = 'none';
        }, 300);
      }
    });

    submitBtn.addEventListener('click', () => {
      const type = eventType.value;
      const cameraId = cameraSelect.value;

      if (!type || !cameraId) {
        alert('–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø —Å–æ–±—ã—Ç–∏—è –∏ –∫–∞–º–µ—Ä—É');
        return;
      }

      confirmModal.style.display = 'block';
    });

    // === –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–î–∞" ===
    confirmYes.addEventListener('click', async () => {
      const type = eventType.value;
      const cameraId = cameraSelect.value;
      const camera = CAMERAS.find(c => c.id == cameraId);

      let photoUrl = null;

      if (ACTIVE_INDEX !== null) {
        const video = document.getElementById(`camera-${ACTIVE_INDEX}`);
        if (video && !video.paused && !video.ended && video.readyState >= 2) {
          const screenshot = captureVideoFrame(video);
          if (screenshot) {
            console.log("üì§ –ó–∞–≥—Ä—É–∂–∞—é —Å–∫—Ä–∏–Ω—à–æ—Ç –Ω–∞ ImgBB...");
            photoUrl = await uploadToImgBB(screenshot);
            if (photoUrl) {
              console.log("‚úÖ –§–æ—Ç–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ:", photoUrl);
            } else {
              console.warn("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ");
            }
          }
        }
      }

      tg.sendData(JSON.stringify({
        type: type,
        camera: camera ? camera.name : '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞',
        timestamp: new Date().toISOString(),
        photo_url: photoUrl
      }));

      confirmModal.style.display = 'none';
      reportModal.classList.remove('active');
      setTimeout(() => {
        overlay.style.display = 'none';
      }, 300);
    });

    confirmNo.addEventListener('click', () => {
      confirmModal.style.display = 'none';
    });
  </script>
</body>
</html>
